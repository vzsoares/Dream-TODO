{% extends 'base.html' %} {% block content %}
<div class="blurred-box container" style="max-width: 600px; min-height: 400px">
  <div class="container todos-cotainer py-2">
    {% include 'components/todoInput.html' %}
    <div id="todos-container" class="d-flex flex-column gap-5 pt-5 pb-2"></div>
  </div>
</div>
{% endblock %} {% block script %}
<script type="text/javascript">
  $(function () {
    let mockList = [
      {
        description: "descriptionTXT1",
        checked: "true",
      },
      {
        description: "descriptionTXT",
        checked: "true",
      },
      {
        description: "descriptionTXT",
        checked: "true",
      },
      {
        description: "descriptionTXTlast",
        checked: "true",
      },
    ];
    const todos_container = $("#todos-container");
    const add_todo = $("#add-todo");
    let listItems = [];
    let dragStartIndex;

    createList();

    function createList() {
      [...mockList].map((e, i) => {
        const listItem = document.createElement("div");
        listItem.setAttribute("data-index", i);
        listItem.classList.add("index-container");

        listItem.innerHTML = `<div
        style="padding: 0.25rem; max-width: 400px; margin: 0 auto"
        class="d-flex align-items-center gap-3 draggable" draggable="true" 
      >
        <div style="width: 3rem">
          <div style="cursor: pointer">
            <span style="font-size: calc(1.25rem + 1.5vw)">
              <span style="color: rgb(255 255 255 / 50%)">
                <i class="fa-solid fa-bars"></i>
              </span>
            </span>
          </div>
        </div>
        <div
          class="w-100 d-flex align-items-center"
          style="
            align-self: stretch;
            border-bottom: 1px solid rgba(255, 255, 255, 0.8);
          "
        >
          <textarea
            class="form-control my-todo-input"
            style="max-height: 100px"
          >${e.description}</textarea>
        </div>
        <div class="ms-auto d-flex align-items-center gap-3">
          <div>
            <input
              class="form-check-input"
              ${e.checked === "true" && "checked"}
              type="checkbox"
              value=""
              style="
                width: calc(1rem + 0.75vw);
                height: calc(1rem + 0.75vw);
                background-color: rgb(255 255 255 / 50%);
              "
            />
          </div>
          <div style="cursor: pointer">
            <span style="font-size: calc(1.25rem + 1.5vw)">
              <span style="color: rgb(255 255 255 / 50%)">
                <i class="fa-solid fa-trash"></i>
              </span>
            </span>
          </div>
        </div>
      </div>`;

        listItems.push(listItem);
        todos_container.append(listItem);
      });
      addEventListeners();
    }

    function dragStart() {
      dragStartIndex =
        +this.closest(".index-container").getAttribute("data-index");
    }
    function dragEnter() {
      this.classList.add("over");
    }
    function dragLeave() {
      this.classList.remove("over");
    }
    function dragOver(e) {
      this.classList.add("over");
      e.preventDefault();
    }
    function dragDrop() {
      const dragEndIndex = +this.getAttribute("data-index");
      swapItems(dragStartIndex, dragEndIndex);

      this.classList.remove("over");
    }

    function swapItems(fromIndex, toIndex) {
      const itemOne = listItems[fromIndex].querySelector(".draggable");
      const itemTwo = listItems[toIndex].querySelector(".draggable");

      listItems[fromIndex].appendChild(itemTwo);
      listItems[toIndex].appendChild(itemOne);
    }
    // TODO touch events
    function addEventListeners() {
      const draggables = document.querySelectorAll(".draggable");
      const draggaListItem = document.querySelectorAll(
        "#todos-container .index-container"
      );

      draggables.forEach((draggable) => {
        draggable.addEventListener("dragstart", dragStart);
      });
      draggaListItem.forEach((item) => {
        item.addEventListener("dragover", dragOver);
        item.addEventListener("drop", dragDrop);
        item.addEventListener("dragenter", dragEnter);
        item.addEventListener("dragleave", dragLeave);
      });
    }
  });
</script>
{% endblock %}
